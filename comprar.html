<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <link href="styles/styles.css" rel="stylesheet"/>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Faculty+Glyphic&display=swap" rel="stylesheet">
    <title>Comprar — Lotus</title>
  </head>
  <body>
    <nav class="navbar">
      <div class="navleft">
        <div class="nav-logo">
          <a href="index.html"> 
            <img src="assets/lotus_pic.png" alt="Lotus Logo"/>
          </a>
          <a href="about.html">Quienes somos?</a>
        </div>
      </div>
      <div class="navright">
        <a href="login.html">Iniciar sesión</a>
        <a href="comprar.html">Precios</a> 
      </div>
    </nav>

    <main class="container page-buy">
      <h1>Formulario de compra</h1>
      <div class="buy-grid">
        <form id="purchase-form" class="form-card" novalidate>
          <fieldset>
            <legend>Datos del cliente</legend>

            <label for="name">Nombre completo *</label>
            <input id="name" name="name" type="text" required minlength="3" placeholder="Ej: Juan Pérez">

            <label for="address">Dirección completa *</label>
            <input id="address" name="address" type="text" required placeholder="Calle, número, ciudad">

            <label for="phone">Teléfono *</label>
            <input id="phone" name="phone" type="tel" required pattern="^[0-9+()\\s-]{6,20}$" placeholder="+54 9 11 1234 5678">

            <label for="email">E-mail *</label>
            <input id="email" name="email" type="email" required placeholder="usuario@dominio.com">

            <label for="payment">Medio de pago *</label>
            <select id="payment" name="payment" required>
              <option value="">-- seleccionar --</option>
              <option value="card">Tarjeta de crédito</option>
              <option value="mercado">Mercado Pago</option>
              <option value="paypal">PayPal</option>
              <option value="transfer">Transferencia bancaria</option>
            </select>
          </fieldset>

          <fieldset>
            <legend>Productos</legend>

            <p class="muted">Seleccioná los productos que querés comprar (precios unitarios).</p>

            <label class="checkbox">
              <input type="checkbox" name="products" value="Lotus Premium" data-price="5.99">
              Lotus Premium — USD 5.99 / mes
            </label>

            <label class="checkbox">
              <input type="checkbox" name="products" value="Backup seguro" data-price="2.50">
              Backup seguro — USD 2.50 (recupero cifrado)
            </label>

            <label class="checkbox">
              <input type="checkbox" name="products" value="Soporte anual" data-price="19.99">
              Soporte anual — USD 19.99
            </label>

            <div class="product-note">
              <small class="muted">Si venís desde la ficha de producto, ese producto se marcará automáticamente.</small>
            </div>
          </fieldset>

          <div class="form-actions">
            <button type="submit" class="btn-primary">Enviar compra</button>
            <button type="reset" class="btn-ghost">Limpiar</button>
          </div>

          <div id="form-messages" aria-live="polite"></div>
        </form>

        <aside class="summary-card">
          <h2>Resumen del pedido</h2>
          <div id="order-summary" class="order-summary">
            <p class="muted">No hay productos seleccionados.</p>
          </div>
          <div class="total-row">
            <span>Total estimado</span>
            <strong id="order-total">USD 0.00</strong>
          </div>
        </aside>
      </div>
    </main>
    </body> 

    <footer class="footer">
      <p>&copy; 2025 Lotus Password Manager</p>
    </footer>

    <script>
    // Helpers
    function money(v){ return Number(v||0).toFixed(2); }

    // Prefill if vienen parámetros
    (function(){
      const params = new URLSearchParams(location.search);
      const prod = params.get('prod');
      const price = params.get('price');
      if (prod) {
        const boxes = document.querySelectorAll('input[name="products"]');
        boxes.forEach(cb=>{
          if (cb.value === prod) cb.checked = true;
          // si hay price sobreescribe data-price
          if (cb.value === prod && price) cb.dataset.price = price;
        });
        updateSummary();
        // scroll to form
        document.getElementById('purchase-form').scrollIntoView({behavior:'smooth', block:'center'});
      }
    })();

    // Dynamically update summary
    function updateSummary(){
      const boxes = document.querySelectorAll('input[name="products"]');
      const summary = document.getElementById('order-summary');
      const totalEl = document.getElementById('order-total');
      let lines = [];
      let total = 0;
      boxes.forEach(cb=>{
        if (cb.checked){
          const price = parseFloat(cb.dataset.price||0);
          lines.push(`<div class="summary-item"><span>${cb.value}</span><span>USD ${money(price)}</span></div>`);
          total += price;
        }
      });
      if (!lines.length){
        summary.innerHTML = '<p class="muted">No hay productos seleccionados.</p>';
      } else {
        summary.innerHTML = lines.join('');
      }
      totalEl.textContent = 'USD ' + money(total);
      return total;
    }

    document.querySelectorAll('input[name="products"]').forEach(el=>{
      el.addEventListener('change', updateSummary);
    });

    // Validación y submit (simulado)
    const form = document.getElementById('purchase-form');
    const messages = document.getElementById('form-messages');

    form.addEventListener('submit', function(ev){
      ev.preventDefault();
      messages.innerHTML = '';
      if (!form.checkValidity()){
        // show minimal validation feedback
        form.reportValidity();
        return;
      }

      // verificar que haya al menos un producto
      const selected = Array.from(document.querySelectorAll('input[name="products"]:checked'));
      if (!selected.length){
        messages.innerHTML = '<p class="error">Seleccioná al menos un producto antes de enviar.</p>';
        return;
      }

      // construir payload (simulado)
      const payload = {
        name: form.name.value.trim(),
        address: form.address.value.trim(),
        phone: form.phone.value.trim(),
        email: form.email.value.trim(),
        payment: form.payment.value,
        products: selected.map(cb=>({name: cb.value, price: parseFloat(cb.dataset.price||0)})),
        total: parseFloat( document.getElementById('order-total').textContent.replace('USD ','') )
      };

      // aquí podrías enviar el payload al backend; para la consigna lo simulamos:
      messages.innerHTML = '<p class="success">Compra simulada correcta. Resumen abajo. (Esto es un demo sin backend)</p>';
      messages.innerHTML += '<pre class="debug">' + JSON.stringify(payload,null,2) + '</pre>';
      // opcional: limpiar form o redirigir
      form.reset();
      updateSummary();
    });
    </script>
  </body>
</html>

